<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†æç»“æœ - æ–‡æœ¬ä¸»é¢˜åˆ†æå·¥å…·</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š æ–‡æœ¬ä¸»é¢˜åˆ†æç»“æœ</h1>
        
        <!-- å¯¼èˆªæ  -->
        {% if not result.error %}
        <div class="navigation" role="navigation" aria-label="ä¸»è¦å¯¼èˆª">
            <div class="nav-links">
                <a href="#purpose" class="nav-link" aria-label="è·³è½¬åˆ°é¡¹ç›®ç›®æ ‡éƒ¨åˆ†">é¡¹ç›®ç›®æ ‡</a>
                <a href="#summary" class="nav-link" aria-label="è·³è½¬åˆ°åˆ†ææ‘˜è¦éƒ¨åˆ†">åˆ†ææ‘˜è¦</a>
                <a href="#insights" class="nav-link" aria-label="è·³è½¬åˆ°å…³é”®æ´å¯Ÿéƒ¨åˆ†">å…³é”®æ´å¯Ÿ</a>
                <a href="#distribution" class="nav-link" aria-label="è·³è½¬åˆ°ä¸»é¢˜åˆ†å¸ƒéƒ¨åˆ†">ä¸»é¢˜åˆ†å¸ƒ</a>
                <a href="#keywords" class="nav-link" aria-label="è·³è½¬åˆ°å…³é”®è¯éƒ¨åˆ†">å…³é”®è¯</a>
                <a href="#examples" class="nav-link" aria-label="è·³è½¬åˆ°ç¤ºä¾‹è¯„è®ºéƒ¨åˆ†">ç¤ºä¾‹è¯„è®º</a>
                {% if result.has_time_data %}
                <a href="#trends" class="nav-link" aria-label="è·³è½¬åˆ°è¶‹åŠ¿åˆ†æéƒ¨åˆ†">è¶‹åŠ¿åˆ†æ</a>
                {% endif %}
                <a href="#details" class="nav-link" aria-label="è·³è½¬åˆ°åˆ†æè¯¦æƒ…éƒ¨åˆ†">åˆ†æè¯¦æƒ…</a>
            </div>
        </div>
        {% endif %}
        
        <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
        <div class="back-to-top" id="backToTop" role="button" aria-label="è¿”å›é¡¶éƒ¨" tabindex="0">â†‘</div>

        <!-- é¡¹ç›®è¯´æ˜ -->
        {% if not result.error %}
        <div class="project-purpose" id="purpose">
            <h2>é¡¹ç›®ç›®æ ‡ä¸ä»·å€¼</h2>
            
            <div class="grid-container">
                <div class="grid-item">
                    <h4>æ ¸å¿ƒç›®æ ‡</h4>
                    <ul>
                        <li>
                            <span>1</span>
                            <span>ä»ç”¨æˆ·åé¦ˆä¸­æå–æœ‰æ•ˆä¿¡æ¯ï¼Œè¯†åˆ«æ ¸å¿ƒå…³æ³¨ç‚¹</span>
                        </li>
                        <li>
                            <span>2</span>
                            <span>ç”Ÿæˆå‡†ç¡®ã€ç›¸å…³çš„ä¸šåŠ¡æ ‡ç­¾ï¼Œç¡®ä¿å”¯ä¸€æ€§å’Œè¯­ä¹‰å®Œæ•´æ€§</span>
                        </li>
                        <li>
                            <span>3</span>
                            <span>è¿‡æ»¤å•†ä¸šæ¨å¹¿ã€å·¥ä½œç›¸å…³ç­‰å¹²æ‰°ä¿¡æ¯ï¼Œç¡®ä¿åˆ†æè´¨é‡</span>
                        </li>
                        <li>
                            <span>4</span>
                            <span>æä¾›ç›´è§‚ã€å¯æ“ä½œçš„åˆ†æç»“æœï¼Œæ”¯æŒä¸šåŠ¡å†³ç­–</span>
                        </li>
                    </ul>
                </div>
                
                <div class="grid-item">
                    <h4>æŠ€æœ¯å®ç°</h4>
                    <ul>
                        <li>
                            <span>â€¢</span>
                            <span>ä½¿ç”¨LDAæ¨¡å‹è¿›è¡Œä¸»é¢˜å»ºæ¨¡ï¼Œæå–æ ¸å¿ƒä¸»é¢˜</span>
                        </li>
                        <li>
                            <span>â€¢</span>
                            <span>é‡‡ç”¨å¤šæ­¥éª¤æ–‡æœ¬é¢„å¤„ç†ï¼Œç¡®ä¿æ•°æ®è´¨é‡</span>
                        </li>
                        <li>
                            <span>â€¢</span>
                            <span>å®ç°æ™ºèƒ½æ ‡ç­¾ç”Ÿæˆï¼Œç¡®ä¿æ ‡ç­¾å”¯ä¸€æ€§å’Œç›¸å…³æ€§</span>
                        </li>
                        <li>
                            <span>â€¢</span>
                            <span>ç»“åˆè¯­ä¹‰å¢å¼ºï¼Œæå‡åˆ†ææ·±åº¦å’Œå‡†ç¡®æ€§</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="divider"></div>
            
            <div class="grid-item">
                <h4>ä»·å€¼ä½“ç°</h4>
                <p>
                    é€šè¿‡æœ¬å·¥å…·çš„åˆ†æç»“æœï¼Œæ‚¨å¯ä»¥å¿«é€Ÿè¯†åˆ«ç”¨æˆ·åé¦ˆä¸­çš„æ ¸å¿ƒé—®é¢˜å’Œéœ€æ±‚ï¼Œå‘ç°é«˜é¢‘ç—›ç‚¹ï¼Œ
                    ä¸ºäº§å“åŠŸèƒ½ä¼˜åŒ–ã€ç”¨æˆ·ä½“éªŒæ”¹è¿›å’Œè¿è¥ç­–ç•¥åˆ¶å®šæä¾›æ•°æ®é©±åŠ¨çš„å†³ç­–æ”¯æŒã€‚
                    åŒæ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¿‡æ»¤æ‰æ— å…³çš„å•†ä¸šæ¨å¹¿å’Œå·¥ä½œç›¸å…³å†…å®¹ï¼Œç¡®ä¿æ‚¨å…³æ³¨çš„æ˜¯ç”¨æˆ·çš„çœŸå®åé¦ˆã€‚
                </p>
            </div>
        </div>
        {% endif %}

        <!-- é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºåŒºåŸŸ -->
        {% if result.error %}  
        <div class="error-section">
            <div class="error-header">
                <h2>å¤„ç†å¤±è´¥</h2>
                <p class="error-message">{{ result.error_message }}</p>
            </div>
            <a href="/" class="back-button">è¿”å›ä¸Šä¼ é¡µé¢</a>
        </div>
        {% else %}   
        <!-- åˆ†æç»“æœæ‘˜è¦ -->
        <div class="result-summary" id="summary">
            <h2>åˆ†æç»“æœ</h2>
            <div class="summary-cards">
                <div class="summary-card">
                    <h3>æ–‡ä»¶å</h3>
                    <p>{{ result.filename }}</p>
                </div>
                <div class="summary-card">
                    <h3>æ€»æ–‡æœ¬æ•°</h3>
                    <p>{{ result.total_texts }}</p>
                </div>
                <div class="summary-card">
                    <h3>æˆåŠŸåˆ†æ</h3>
                    <p>{{ result.successful_analyses }}</p>
                </div>
                <div class="summary-card">
                    <h3>æˆåŠŸç‡</h3>
                    <p>{% if result.total_texts > 0 %}{{ ((result.successful_analyses / result.total_texts) * 100)|round(1) }}%{% else %}0.0%{% endif %}</p>
                </div>
            </div>
        </div>
        
        <!-- å…³é”®æ´å¯Ÿ -->
        <div class="key-insights" id="insights">
            <h2>ğŸ’¡ å…³é”®æ´å¯Ÿ</h2>
            
            <div class="grid-container">
                <!-- ä¸»è¦å‘ç° -->
                <div class="grid-item">
                    <h4>ä¸»è¦å‘ç°</h4>
                    <ul>
                        <li>
                            <span>âœ¨</span>
                            <span>
                                {% if result.themes_count %}
                                    è¯†åˆ«å‡º {{ result.themes_count|length }} ä¸ªæ ¸å¿ƒä¸»é¢˜ï¼Œå…¶ä¸­
                                    {% set sorted_themes = result.themes_count|dictsort(false, 'value', reverse=true) %}
                                    {{ result.theme_names.get(sorted_themes[0][0], sorted_themes[0][0]) }} æœ€ä¸ºçªå‡ºï¼Œ
                                    å æ¯” {% if result.successful_analyses > 0 %}{{ ((sorted_themes[0][1] / result.successful_analyses) * 100)|round(1) }}%{% else %}0%{% endif %}
                                {% else %}
                                    æœªè¯†åˆ«å‡ºæ˜æ˜¾ä¸»é¢˜
                                {% endif %}
                            </span>
                        </li>
                        <li>
                            <span>ğŸ”</span>
                            <span>
                                åˆ†æäº† {{ result.successful_analyses }} æ¡æœ‰æ•ˆè¯„è®ºï¼Œ
                                {% if result.total_texts > result.successful_analyses %}
                                    è¿‡æ»¤æ‰äº† {{ result.total_texts - result.successful_analyses }} æ¡æ— æ•ˆå†…å®¹
                                {% endif %}
                            </span>
                        </li>
                    </ul>
                </div>
                
                <!-- çƒ­ç‚¹é—®é¢˜ -->
                <div class="grid-item">
                    <h4>çƒ­ç‚¹é—®é¢˜</h4>
                    <ul>
                        <li>
                            <span>ğŸ”¥</span>
                            <span>
                                {% if result.top_keywords %}
                                    çƒ­é—¨å…³é”®è¯åŒ…æ‹¬ï¼š
                                    {% for keyword in result.top_keywords[:5] %}
                                        {{ keyword }}{% if not loop.last %}, {% endif %}
                                    {% endfor %}
                                {% else %}
                                    æœªæå–åˆ°å…³é”®è¯
                                {% endif %}
                            </span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="divider"></div>
            
            <!-- è¡ŒåŠ¨å»ºè®® -->
            <div class="grid-item">
                <h4>ğŸ“‹ è¡ŒåŠ¨å»ºè®®</h4>
                <div class="grid-container">
                    <div class="grid-item">
                        <h5>äº§å“ä¼˜åŒ–</h5>
                        <p>
                            åŸºäºåˆ†æç»“æœï¼Œå»ºè®®é‡ç‚¹å…³æ³¨ç”¨æˆ·åé¦ˆæœ€å¤šçš„ä¸»é¢˜ï¼Œé’ˆå¯¹æ€§åœ°ä¼˜åŒ–äº§å“åŠŸèƒ½å’Œç”¨æˆ·ä½“éªŒã€‚
                        </p>
                    </div>
                    <div class="grid-item">
                        <h5>è¿è¥ç­–ç•¥</h5>
                        <p>
                            æ ¹æ®çƒ­ç‚¹é—®é¢˜è°ƒæ•´è¿è¥ç­–ç•¥ï¼ŒåŠ å¼ºä¸ç”¨æˆ·çš„äº’åŠ¨ï¼Œæé«˜ç”¨æˆ·æ»¡æ„åº¦å’Œç•™å­˜ç‡ã€‚
                        </p>
                    </div>
                    <div class="grid-item">
                        <h5>åç»­åˆ†æ</h5>
                        <p>
                            å»ºè®®å®šæœŸæ”¶é›†å’Œåˆ†æç”¨æˆ·åé¦ˆï¼Œè·Ÿè¸ªä¸»é¢˜å˜åŒ–è¶‹åŠ¿ï¼ŒæŒç»­ä¼˜åŒ–äº§å“å’ŒæœåŠ¡ã€‚
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ä¸»é¢˜åˆ†å¸ƒ -->
        <div class="theme-distribution" id="distribution">
            <h3>ä¸»é¢˜åˆ†å¸ƒ</h3>
            <div class="grid-container">
                <!-- é¥¼å›¾ -->
                <div class="grid-item chart-container" role="figure" aria-label="ä¸»é¢˜å æ¯”é¥¼å›¾">
                    <h4>ä¸»é¢˜å æ¯”</h4>
                    <div style="height: 400px;">
                        <canvas id="themePieChart" aria-label="ä¸»é¢˜å æ¯”æ•°æ®å¯è§†åŒ–"></canvas>
                    </div>
                </div>
                
                <!-- æ¡å½¢å›¾ -->
                <div class="grid-item chart-container" role="figure" aria-label="ä¸»é¢˜æ•°é‡æ¡å½¢å›¾">
                    <h4>ä¸»é¢˜æ•°é‡</h4>
                    <div style="height: 400px;">
                        <canvas id="themeBarChart" aria-label="ä¸»é¢˜æ•°é‡æ•°æ®å¯è§†åŒ–"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ä¸»é¢˜å…³é”®è¯ -->
        <div class="theme-keywords" id="keywords">
            <h3>ä¸»é¢˜å…³é”®è¯</h3>
            {% if result.theme_keywords %}
            <div class="keywords-grid">
                {% for theme, keywords in result.theme_keywords.items() %}
                <div class="keyword-card">
                    <h4>{{ result.theme_names.get(theme, theme) }}</h4>
                    <div class="keywords-list">
                        {% for keyword in keywords %}
                        <span class="keyword">
                            {{ keyword }}
                        </span>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="no-data-message">æš‚æ— ä¸»é¢˜å…³é”®è¯æ•°æ®</p>
            {% endif %}
        </div>
        
        <!-- ç¤ºä¾‹è¯„è®º -->
        <div class="example-comments" id="examples">
            <h3>ç¤ºä¾‹è¯„è®º</h3>
            {% if result.theme_examples %}
            <div class="comments-grid">
                {% for theme, examples in result.theme_examples.items() %}
                <div class="example-card">
                    <h4>{{ result.theme_names.get(theme, theme) }}</h4>
                    {% if examples %}
                    <!-- æ˜¾ç¤ºç¬¬ä¸€æ¡ç¤ºä¾‹ -->
                    <div class="example-item">
                        <p class="example-text">{{ examples[0].text[:100] }}{% if examples[0].text|length > 100 %}...{% endif %}</p>
                        <div class="example-meta">
                            <span class="confidence" title="ç½®ä¿¡åº¦ï¼šæ¨¡å‹å¯¹ä¸»é¢˜åˆ†ç±»çš„ç¡®å®šæ€§åˆ†æ•°ï¼ŒèŒƒå›´0-1ï¼Œæ•°å€¼è¶Šé«˜è¡¨ç¤ºåˆ†ç±»è¶Šå¯é ">
                                ç½®ä¿¡åº¦: {{ examples[0].confidence|round(2) }}
                            </span>
                            <div class="example-keywords">
                                {% for keyword in examples[0].get('keywords', [])[:3] %}
                                <span class="keyword">{{ keyword }}</span>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    <!-- å±•å¼€/æ”¶èµ·æŒ‰é’® -->
                    {% if examples|length > 1 %}
                    <button onclick="toggleExamples('{{ theme }}', event)" class="toggle-button" aria-expanded="false" aria-controls="examples-{{ theme }}-hidden" aria-label="å±•å¼€æˆ–æ”¶èµ·{{ result.theme_names.get(theme, theme) }}çš„ç¤ºä¾‹è¯„è®º">
                        æ˜¾ç¤ºå…¨éƒ¨ {{ examples|length }} æ¡ç¤ºä¾‹
                    </button>
                    <!-- éšè—çš„ç¤ºä¾‹ -->
                    <div id="examples-{{ theme }}-hidden" style="display: none; margin-top: 15px;">
                        {% for example in examples[1:] %}
                        <div class="example-item">
                            <p class="example-text">{{ example.text[:100] }}{% if example.text|length > 100 %}...{% endif %}</p>
                            <div class="example-meta">
                                <span class="confidence" title="ç½®ä¿¡åº¦ï¼šæ¨¡å‹å¯¹ä¸»é¢˜åˆ†ç±»çš„ç¡®å®šæ€§åˆ†æ•°ï¼ŒèŒƒå›´0-1ï¼Œæ•°å€¼è¶Šé«˜è¡¨ç¤ºåˆ†ç±»è¶Šå¯é ">
                                    ç½®ä¿¡åº¦: {{ example.confidence|round(2) }}
                                </span>
                                <div class="example-keywords">
                                    {% for keyword in example.get('keywords', [])[:3] %}
                                    <span class="keyword">{{ keyword }}</span>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="no-data-message">æš‚æ— ç¤ºä¾‹è¯„è®ºæ•°æ®</p>
            {% endif %}
        </div>
        
        {% if result.has_time_data %}
        <!-- è¶‹åŠ¿åˆ†æ -->
        <div class="trend-analysis" id="trends">
            <h3>ğŸ“ˆ è¶‹åŠ¿åˆ†æ</h3>
            
            <div class="grid-container">
                <!-- ä¸»é¢˜è¶‹åŠ¿å›¾ -->
                <div class="grid-item chart-container" role="figure" aria-label="ä¸»é¢˜è¶‹åŠ¿æŠ˜çº¿å›¾">
                    <h4>ä¸»é¢˜è¶‹åŠ¿</h4>
                    <div style="height: 400px;">
                        <canvas id="themeTrendChart" aria-label="ä¸»é¢˜è¶‹åŠ¿æ•°æ®å¯è§†åŒ–"></canvas>
                    </div>
                </div>
                
                <!-- å…³é”®è¯è¶‹åŠ¿å›¾ -->
                <div class="grid-item chart-container" role="figure" aria-label="å…³é”®è¯è¶‹åŠ¿æŠ˜çº¿å›¾">
                    <h4>å…³é”®è¯è¶‹åŠ¿</h4>
                    <div style="height: 400px;">
                        <canvas id="keywordTrendChart" aria-label="å…³é”®è¯è¶‹åŠ¿æ•°æ®å¯è§†åŒ–"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="divider"></div>
            
            <!-- å¯¹æ¯”åˆ†æ -->
            <div>
                <h4>ğŸ“Š å¯¹æ¯”åˆ†æ</h4>
                <div class="grid-container">
                    <!-- ä¸»é¢˜å¯¹æ¯” -->
                    <div class="grid-item chart-container" role="figure" aria-label="ä¸»é¢˜å¯¹æ¯”é›·è¾¾å›¾">
                        <h5>ä¸»é¢˜å¯¹æ¯”</h5>
                        <div style="height: 300px;">
                            <canvas id="themeComparisonChart" aria-label="ä¸»é¢˜å¯¹æ¯”æ•°æ®å¯è§†åŒ–"></canvas>
                        </div>
                    </div>
                    
                    <!-- ç½®ä¿¡åº¦å¯¹æ¯” -->
                    <div class="grid-item chart-container" role="figure" aria-label="ç½®ä¿¡åº¦å¯¹æ¯”æ¡å½¢å›¾">
                        <h5>ç½®ä¿¡åº¦å¯¹æ¯”</h5>
                        <div style="height: 300px;">
                            <canvas id="confidenceComparisonChart" aria-label="ç½®ä¿¡åº¦å¯¹æ¯”æ•°æ®å¯è§†åŒ–"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- åˆ†æè¯¦æƒ… -->
        <div class="analysis-details" id="details">
            <h3>åˆ†æè¯¦æƒ…</h3>
            {% if result.analysis_details %}
            <table class="details-table" role="table" aria-label="åˆ†æè¯¦æƒ…è¡¨æ ¼">
                <thead role="rowgroup">
                    <tr role="row">
                        <th role="columnheader" aria-sort="none">è¯„è®ºå†…å®¹</th>
                        <th role="columnheader" aria-sort="none">ä¸»é¢˜</th>
                        <th role="columnheader" aria-sort="none">ç½®ä¿¡åº¦</th>
                        <th role="columnheader" aria-sort="none">å…³é”®è¯</th>
                    </tr>
                </thead>
                <tbody role="rowgroup">
                    {% for item in result.analysis_details[:100] %}
                    <tr role="row">
                        <td role="cell" class="comment-text">{{ item.text[:100] }}{% if item.text|length > 100 %}...{% endif %}</td>
                        <td role="cell">{{ result.theme_names.get(item.theme, item.theme) }}</td>
                        <td role="cell">{{ item.confidence|round(2) }}</td>
                        <td role="cell">
                            <div class="keywords">
                                {% for keyword in item.get('keywords', [])[:5] %}
                                <span class="keyword">{{ keyword }}</span>
                                {% endfor %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% if result.analysis_details|length > 100 %}
            <div class="more-results">
                æ˜¾ç¤ºå‰ 100 æ¡ç»“æœï¼Œå…± {{ result.analysis_details|length }} æ¡
            </div>
            {% endif %}
            {% else %}
            <p class="no-data-message">æš‚æ— åˆ†æè¯¦æƒ…æ•°æ®</p>
            {% endif %}
        </div>
        
        <!-- è¿”å›æŒ‰é’® -->
        <div style="text-align: center;">
            <a href="/" class="back-button">è¿”å›ä¸Šä¼ é¡µé¢</a>
        </div>
        {% endif %}
    </div>

    <!-- æ•°æ®ä¼ é€’è„šæœ¬ -->
    <script>
        // å°†ä¸»é¢˜åˆ†ææ•°æ®ä¼ é€’ç»™JavaScript
        window.themeAnalysisData = {
            theme_names: {% if result.theme_names %}{{ result.theme_names|tojson }}{% else %}{}{% endif %},
            themes_count: {% if result.themes_count %}{{ result.themes_count|tojson }}{% else %}{}{% endif %},
            has_time_data: {% if result.has_time_data %}{{ result.has_time_data|tojson }}{% else %}false{% endif %},
            time_series_data: {% if result.time_series_data %}{{ result.time_series_data|tojson }}{% else %}{}{% endif %},
            keyword_time_series: {% if result.keyword_time_series %}{{ result.keyword_time_series|tojson }}{% else %}{}{% endif %},
            top_keywords: {% if result.top_keywords %}{{ result.top_keywords|tojson }}{% else %}[]{% endif %},
            theme_confidence: {% if result.theme_confidence %}{{ result.theme_confidence|tojson }}{% else %}{}{% endif %}
        };
    </script>

    <script src="/static/js/main.js"></script>
</body>
</html>